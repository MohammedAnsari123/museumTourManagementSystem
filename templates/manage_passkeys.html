<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Pass Keys</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_style.css') }}" />
  <style>
    .passkey-form {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      width: 500px;
      margin: 20px auto;
    }
    
    .passkey-form h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .form-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .form-group button {
      width: 100%;
      padding: 10px;
      background: #9BD3C4;
      color: black;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    .form-group button:hover {
      background: #6fb7a6;
    }
    
    .passkey-list {
      margin-top: 30px;
    }
    
    .passkey-list h3 {
      text-align: center;
      margin-bottom: 15px;
    }
    
    .passkey-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    
    .passkey-item .passkey-value {
      font-family: monospace;
      background: #f0f0f0;
      padding: 5px 10px;
      border-radius: 4px;
    }
    
    .passkey-item button {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .passkey-item button:hover {
      background: #ff5252;
    }
    
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      text-align: center;
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <header class="admin-header">
    <div class="header-content">
      <h1>Manage Pass Keys</h1>
      <p>Create and manage admin pass keys</p>
    </div>
    <div class="admin-nav">
      <a href="{{ url_for('admin_home') }}" class="nav-link">Dashboard</a>
      <a href="{{ url_for('gallery') }}" class="nav-link">Gallery</a>
      <div class="auth-buttons">
        <button class="auth-btn logout-btn" onclick="window.location.href='{{ url_for('home') }}'">Logout</button>
      </div>
    </div>
  </header>

  <main class="dashboard">
    <div class="passkey-form">
      <h2>Create New Pass Key</h2>
      <div class="form-group">
        <label for="newPassKey">New Pass Key:</label>
        <input type="text" id="newPassKey" placeholder="Enter new pass key" required />
      </div>
      <div class="form-group">
        <label for="confirmPassKey">Confirm Pass Key:</label>
        <input type="text" id="confirmPassKey" placeholder="Confirm pass key" required />
      </div>
      <div class="form-group">
        <button onclick="createPassKey()">Create Pass Key</button>
      </div>
      <div id="createMessage" class="message" style="display: none;"></div>
    </div>

    <div class="passkey-list">
      <h3>Current Pass Keys</h3>
      <div id="passKeyList">
        <!-- Pass keys will be loaded here dynamically -->
      </div>
    </div>
  </main>

  <script>
    // Load pass keys when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadPassKeys();
    });
    
    // Create a new pass key
    function createPassKey() {
      const newPassKey = document.getElementById('newPassKey').value;
      const confirmPassKey = document.getElementById('confirmPassKey').value;
      const messageElement = document.getElementById('createMessage');
      
      if (!newPassKey || !confirmPassKey) {
        showMessage(messageElement, 'Please fill all fields.', 'error');
        return;
      }
      
      if (newPassKey !== confirmPassKey) {
        showMessage(messageElement, 'Pass keys do not match.', 'error');
        return;
      }
      
      // Send request to backend to create pass key
      fetch('/api/admin/passkeys', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ passkey: newPassKey }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          showMessage(messageElement, data.message, 'success');
          
          // Clear the form
          document.getElementById('newPassKey').value = '';
          document.getElementById('confirmPassKey').value = '';
          
          // Reload the pass key list
          loadPassKeys();
        } else {
          showMessage(messageElement, data.error || 'Failed to create pass key', 'error');
        }
      })
      .catch(error => {
        showMessage(messageElement, 'An error occurred. Please try again.', 'error');
      });
    }
    
    // Load pass keys from backend
    function loadPassKeys() {
      const listElement = document.getElementById('passKeyList');
      
      // Show loading message
      listElement.innerHTML = '<p>Loading pass keys...</p>';
      
      // Fetch pass keys from backend
      fetch('/api/admin/passkeys')
      .then(response => response.json())
      .then(data => {
        if (data.passkeys) {
          // Display pass keys
          if (data.passkeys.length > 0) {
            listElement.innerHTML = data.passkeys.map(passKey => `
              <div class="passkey-item">
                <span class="passkey-value">${passKey.passkey}</span>
                <button onclick="deletePassKey('${passKey.passkey}')">Delete</button>
              </div>
            `).join('');
          } else {
            listElement.innerHTML = '<p>No pass keys found.</p>';
          }
        } else {
          listElement.innerHTML = '<p>Error loading pass keys.</p>';
        }
      })
      .catch(error => {
        listElement.innerHTML = '<p>Error loading pass keys.</p>';
      });
    }
    
    // Delete a pass key
    function deletePassKey(passKey) {
      if (!confirm('Are you sure you want to delete this pass key?')) {
        return;
      }
      
      // Send request to backend to delete pass key
      fetch(`/api/admin/passkeys/${passKey}`, {
        method: 'DELETE',
      })
      .then(response => response.json())
      .then(data => {
        if (data.message) {
          alert(data.message);
          loadPassKeys();
        } else {
          alert(data.error || 'Failed to delete pass key');
        }
      })
      .catch(error => {
        alert('An error occurred. Please try again.');
      });
    }
    
    // Show a message
    function showMessage(element, message, type) {
      element.textContent = message;
      element.className = 'message ' + type;
      element.style.display = 'block';
      
      // Hide the message after 5 seconds
      setTimeout(() => {
        element.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Museum Chatbot - PixelPast Museum</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='VisitersHomePage.css') }}" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Chatbot specific styles */
    .chatbot-container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .chat-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #9BD3C4;
    }
    
    .chat-messages {
      height: 400px;
      overflow-y: auto;
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
    }
    
    .message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 8px;
      max-width: 80%;
    }
    
    .user-message {
      background: #9BD3C4;
      margin-left: auto;
      text-align: right;
    }
    
    .bot-message {
      background: #e0e0e0;
      margin-right: auto;
    }
    
    .chat-input {
      display: flex;
      gap: 10px;
    }
    
    .chat-input input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 16px;
    }
    
    .chat-input button {
      padding: 12px 20px;
      background: #9BD3C4;
      color: black;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .chat-input button:hover {
      background: #7dbfc4;
    }
    
    .chatbot-features {
      margin-top: 30px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }
    
    .feature-card {
      padding: 15px;
      background: #f0f8f8;
      border-radius: 8px;
      text-align: center;
    }
    
    .feature-card i {
      font-size: 24px;
      color: #9BD3C4;
      margin-bottom: 10px;
    }
    
    .typing-indicator {
      display: none;
      padding: 10px;
      background: #e0e0e0;
      border-radius: 8px;
      margin-bottom: 15px;
      width: fit-content;
    }
    
    .typing-indicator span {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #666;
      border-radius: 50%;
      margin: 0 2px;
      animation: typing 1s infinite;
    }
    
    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
  </style>
</head>

<body class="light-mode">

  <!-- Navigation Header -->
  <header class="visitor-nav">
    <div class="nav-logo">
      <h2><i class="fas fa-museum"></i> PixelPast Museum</h2>
    </div>
    <nav class="nav-menu">
      <a href="{{ url_for('home') }}"><i class="fas fa-home"></i> Home</a>
      <a href="{{ url_for('gallery') }}"><i class="fas fa-images"></i> Gallery</a>
      <a href="{{ url_for('visitor_home') }}#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="{{ url_for('chatbot_page') }}" class="active"><i class="fas fa-robot"></i> Museum Chatbot</a>
    </nav>
    <div class="nav-auth">
      {% if user %}
      <span class="user-welcome">Welcome, {{ user.username }}!</span>
      <a href="{{ url_for('visitor_logout') }}" class="auth-btn logout-btn" style="background: #9BD3C4;
    color: black;
    display: flex;
    width: 130px;
    border-radius: 5px;
    list-style: none;
    text-align: center;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    font-weight: 700;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
      {% else %}
      <a href="{{ url_for('visitor_login') }}" class="auth-btn login-btn">
        <i class="fas fa-sign-in-alt"></i> Login
      </a>
      <a href="{{ url_for('visitor_register') }}" class="auth-btn register-btn">
        <i class="fas fa-user-plus"></i> Register
      </a>
      {% endif %}
    </div>
  </header>

  <button id="toggle-mode" class="theme-toggle">ðŸŒ™</button>

  <!-- Chatbot Section -->
  <section class="chatbot-container">
    <div class="chat-header">
      <h1><i class="fas fa-robot"></i> Museum Information Chatbot</h1>
      <p>Ask me about museums, their locations, types, or specific information!</p>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="message bot-message">
        <strong>Chatbot:</strong> Hello! I'm your Museum Information Assistant. I can help you find information about museums in India. You can ask me about specific museums, search for museums in specific locations, or ask about different types of museums. What would you like to know?
      </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
      <span></span>
      <span></span>
      <span></span>
    </div>
    
    <div class="chat-input">
      <input type="text" id="userInput" placeholder="Ask about museums..." />
      <button id="sendButton"><i class="fas fa-paper-plane"></i> Send</button>
      <button id="resetButton" style="background: #ff6b6b;"><i class="fas fa-sync"></i> Reset</button>
    </div>
  </section>

  <!-- Chatbot Features -->
  <section class="chatbot-features">
    <h2><i class="fas fa-star"></i> What I Can Help You With</h2>
    <div class="feature-grid">
      <div class="feature-card">
        <i class="fas fa-search"></i>
        <h3>Find Museums</h3>
        <p>Search for museums by name, city, or type</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-info-circle"></i>
        <h3>Museum Details</h3>
        <p>Get detailed information about specific museums</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-map-marker-alt"></i>
        <h3>Location-Based</h3>
        <p>Find museums in specific cities or states</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-list"></i>
        <h3>Museum Types</h3>
        <p>Learn about different types of museums</p>
      </div>
    </div>
  </section>

  <script>
    // DOM Elements
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const resetButton = document.getElementById('resetButton');
    const typingIndicator = document.getElementById('typingIndicator');

    // Add message to chat
    function addMessage(sender, text) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');
      messageDiv.classList.add(sender + '-message');
      
      if (sender === 'bot') {
        messageDiv.innerHTML = `<strong>Chatbot:</strong> ${text}`;
      } else {
        messageDiv.innerHTML = `<strong>You:</strong> ${text}`;
      }
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show typing indicator
    function showTyping() {
      typingIndicator.style.display = 'block';
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Hide typing indicator
    function hideTyping() {
      typingIndicator.style.display = 'none';
    }

    // Send message to chatbot API
    async function sendToChatbot(message) {
      showTyping();
      
      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message: message })
        });
        
        const data = await response.json();
        hideTyping();
        
        if (response.ok) {
          addMessage('bot', data.response);
        } else {
          addMessage('bot', 'Sorry, I encountered an error. Please try again.');
        }
      } catch (error) {
        hideTyping();
        addMessage('bot', 'Sorry, I\'m having trouble connecting. Please try again later.');
      }
    }

    // Reset chat history
    async function resetChat() {
      try {
        const response = await fetch('/api/chat/reset', {
          method: 'POST'
        });
        
        if (response.ok) {
          chatMessages.innerHTML = '<div class="message bot-message"><strong>Chatbot:</strong> Hello! I\'m your Museum Information Assistant. I can help you find information about museums in India. You can ask me about specific museums, search for museums in specific locations, or ask about different types of museums. What would you like to know?</div>';
        }
      } catch (error) {
        console.error('Error resetting chat:', error);
      }
    }

    // Event Listeners
    sendButton.addEventListener('click', () => {
      const message = userInput.value.trim();
      if (message) {
        addMessage('user', message);
        userInput.value = '';
        sendToChatbot(message);
      }
    });

    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendButton.click();
      }
    });

    resetButton.addEventListener('click', () => {
      resetChat();
    });

    // Focus on input when page loads
    window.addEventListener('load', () => {
      userInput.focus();
    });
  </script>

  <script src="{{ url_for('static', filename='VisitersHomePage.js') }}"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>

</body>

</html>